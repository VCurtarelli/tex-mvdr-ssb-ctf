\section{Signal Model and Beamforming}
\label{sec:signal_model}

Let there be a device that consists of $M$ sensors and a loudspeaker (LS) in a reverberant environment, in which there also is a desired source, both traveling with a speed $c$. We also assume the presence of undesired noise at each sensor. For simplicity we assume that all sources are spatially stationary, although this condition can be easily removed.

We denote $Y_{m,k}[l]$ as the signal at the $m$-th sensor on the time-frequency domain, being represented by
\begin{equation}
	\label{eq:sec3:system_time-freq_domain_base}
	Y_{m,k}[l] = X_{m,k}[l] + S_{m,k}[l] + R_{m,k}[l]
\end{equation}
where $X_{m,k}[l]$ is a desired signal component, $S_{m,k}[l]$ is the undesired loudspeaker signal that is captured by the sensors, and $R_{m,k}[l]$ is uncorrelated white noise present in the sensors. $m$ is the sensor index ($1 \leq m \leq M$), $k$ is the frequency bin index ($0 \leq k < K$), and $l$ is the decimated-time index. We will use a different notation to the one previously used, for ease of reading.

Treating the multiple paths between the desired source and the $m$-th sensor as a system, with the CTF model $X_{m,k}[l]$ can be represented by \cref{eq:sec2:system_ctf_ssbt_output}, as
\begin{equation}
	\label{eq:sec3:def_ctf_ssbt}
	X_{m,k}[l] = A_{m,k}'[l] \ast X_{1,k}'[l] + A_{m,k}''[l] \ast X_{1,k}''[l]
\end{equation}\vspace*{-2em}
\begin{subgather}{eqs:sec3:def_desired_signals_ssbt}
	X_{1,k}'[l] = H_{1,k}'[l] \ast X_k[l] \\
	X_{1,k}''[l] = H_{1,k}''[l] \ast X_{K-k}[l]
\end{subgather}
where $X_{1,k}'[l]$ is the portion of the desired signal at the reference sensor of the direct frequency, $X_{1,k}''[l]$ is the desired signal on the conjugate frequency $(K-k)$, $H^n_{1,k}[l]$ are the desired signal's transfer functions between source and reference, and $A^n_{m,k}[l]$ are the RFR's between each sensor and the reference. This formulation models both the STFT and the SSBT, as with the STFT we just take $A_{m,k}''[l] = H_{m,k}''[l] = 0$, as there is no cross-over between conjugate frequencies.

Note that $A_{m,k}[l]$ isn't strictly a causal response, depending on the direction of arrival and features of the reverberant environment, as well as relative delays between the sources at each sensor. We will assume that there are $\Delta$ non-causal samples in $A_{m,k}[l]$. It is trivial to see that, for \cref{eq:sec3:def_ctf_ssbt} to be respected, $A_{1,k}'[l] = A_{1,k}''[l] = \delta_{0,l}$, a Kronecker delta at $l=0$.

%\begin{changingfrom}
%	We consider the delayed signal $X_{m,k}[l+\lambda]$, such that, when expanding the convolutions, we have
%	\begin{equation}
%		X_{m,k}[l+\lambda] = \sum_{\tau} \pts{A_{m,k}'[\tau] X_{1,k}'[l+\lambda-\tau] + A_{m,k}''[\tau] X_{1,k}''[l+\lambda-\tau]}
%	\end{equation}
%	Now we explicit the contribution of $X^n_{1,k}[l]$ on the summation, leading us to
%	\begin{equations}
%		X_{m,k}[l+\lambda]
%		& = A_{m,k}'[\lambda] X_{1,k}'[l] + A_{m,k}''[\lambda] X_{1,k}''[l] \\
%		& + \sum_{\tau\neq\lambda} \pts{A_{m,k}'[\tau] X_{1,k}'[l+\lambda-\tau] + A_{m,k}''[\tau] X_{1,k}''[l+\lambda-\tau]} \\[0.2cm]
%		& = A_{m,k}'[\lambda] X_{1,k}'[l] + A_{m,k}''[\lambda] X_{1,k}''[l] + Q_{m,k}[l+\lambda]
%	\end{equations}
%	where the first two terms are the contributions of the desired signals $X_{1,k}'[l]$ and $X_{1,k}''[l]$ at the time of interest $l$, and $Q_{m,k}[l+\lambda]$ are the remaining terms of the convolution, which can be regarded as only reverberation. Using this on \cref{eq:sec3:system_time-freq_domain_base} with \cref{eq:sec3:def_ctf_ssbt}, we have that
%	\begin{equation}
%		Y_{m,k}[l+\lambda] = A_{m,k}'[\lambda] X_{1,k}'[l] + A_{m,k}''[\lambda] X_{1,k}''[l] + Q_{m,k}[l+\lambda] + S_{m,k}[l+\lambda] + R_{m,k}[l+\lambda]
%	\end{equation}
%	
%	We consider $\Ly$ previous and $\Ly*$ future frames of $Y_{m,k}[l]$, and let $L = \Ly + \Ly* + 1$ the total number of frames. With this, we define $\bvY{m,k}[l]$ as a vector containing those $L$ samples,
%	\begin{equation}
%		\bvY{m,k}[l] = \bvA{m,k}' X_{1,k}'[l] +  \bvA{m,k}'' X_{1,k}''[l] + \bvQ{m,k}[l] + \bvS{m,k}[l] + \bvR{m,k}[l]
%	\end{equation}
%	in which
%	\begin{equation}
%		\label{eq:sec3:def_bvY_sample-stacking}
%		\bvY{m,k}[l] = \tr{ \tup{ {Y_{m,k}[l+\Ly*]} ,, {Y_{m,k}[l]} ,, {Y_{m,k}[l-\Ly]} } }
%	\end{equation}
%	similarly for $\bvQ{m,k}[l]$, $\bvS{m,k}[l]$ and $\bvR{m,k}[l]$, and
%	\begin{equation}
%		\bvA_{m,k}^n = \tr{\tup{ {A^n_{m,k}[\Ly*]} ,, {A^n_{m,k}[0]} ,, {A^n_{m,k}[-\Ly]} }}
%	\end{equation}
%	with all of them being $\sz{L}{1}$ vectors.
%	
%	Now stacking these signals in a vector sensor-wise, we get
%	\begin{equation}
%		\label{eq:sec3:def_bvy_sensor-stacking}
%		\bvy{k}[l] = \bva{k}' X_{1,k}'[l] + \bva{k}'' X_{1,k}''[l] + \bvq{k}[l] + \bvs{k}[l] + \bvr{k}[l]
%	\end{equation}
%	with
%	\begin{equation}
%		\bvy{k}[l] = \tr{\tup{ \tr{\bvY{1,k}}[l] ,, \tr{\bvY{M,k}}[l] }}
%	\end{equation}
%	and the same for $\bva{k}^n$, $\bvq{k}[l]$, $\bvs{k}[l]$ and $\bvr{k}[l]$, where them all are $\sz{ML}{1}$ vectors.
%\end{changingfrom}
%\begin{changingto}
We assume that $A_{m,k}^n[l]$ can be approximated by a truncated impulse response $D_{m,k}^n[l]$ with $\Ld$ samples, such that
\begin{equations}
	X_{m,k}^n[l]
	& = A_{m,k}^n[l] \ast X_{1,k}^n[l] \\
	& \approx D_{m,k}^n[l] \ast X_{1,k}^n[l]
\end{equations}
in which $D_{m,k}^n[l]$ has $\Delta$ non-causal and $\Ld*$ causal samples, with $\Ld = \Delta + \Ld* + 1$. By defining the convolution as a vector multiplication, given by
\begin{equation}
	D_{m,k}^n[l] \ast X_{1,k}^n[l] = \tr*{\bvd{m,k}^n} \bvx{1,k}^n[l]
\end{equation}
where $\bvx{1,k}^n[l]$ and $\bvd{m,k}^n$ are vectorized versions of our signals, given by
\begin{subgather}
	\bvx{1,k}^n[l] = \tr{\tup{ X_{1,k}^n[l+\Delta] ,, X_{1,k}^n[l] ,, X_{1,k}^n[l-\Ld*] }} \\
	\bvd{m,k}^n = \tr{\tup{ A_{m,k}^n[-\Delta] ,, A_{m,k}^n[0] ,, A_{m,k}^n[\Ld*] }} 
\end{subgather}
and with this, our observed signal $Y_{m,k}[l]$ is written as
\begin{equation}
	Y_{m,k}[l] \approx \he*{\bvd{m,k}'} \bvx{1,k}'[l] + \he*{\bvd{m,k}''} \bvx{1,k}''[l] + S_{m,k}[l] + R_{m,k}[l]
\end{equation}

We now consider $\Ly$ previous samples of $Y_{m,k}[l]$, giving us
\begin{equations}
	\bvY{m,k}[l]
	& = \tr{\tup{ Y_{m,k}[l] , Y_{m,k}[l-1] ,, Y_{m,k}[l-\Ly+1] }} \\
	& = \bvD[b]{m,k}' \bvx[b]{1,k}'[l] + \bvD[b]{m,k}' \bvx[b]{1,k}''[l] + \bvS{m,k}[l] + \bvR{m,k}[l]
\end{equations}
in which $\bvD[b]{m,k}^n$ is a $\sz{\Ly}{L}$ Toeplitz matrix with $L = \Ld + \Ly - 1$, and $\bvx[b]{1,k}^n[l]$ is a $\sz{L}{1}$ vector of our desired signal
\begin{subgather}{eq:sec3:sample-stacking_bvDb_bvxb}
	\bvD[b]{m,k}^n = \begin{bmatrix}
		\tr*{\bvd{m,k}^n} & 0 & \cdots & 0 \\
		0 & \tr*{\bvd{m,k}^n} & \cdots & 0 \\
		\vdots & \vdots & \ddots & \vdots \\
		0 & 0 & \cdots & \tr*{\bvd{m,k}^n}
	\end{bmatrix}  \label{eq:sec3:sample-stacking_bvDb_bvxb:subeq1} \\
	\bvx[b]{1,k}^n[l] = \tr{\tup{ X_{1,k}^n[l+\Delta] ,, X_{1,k}^n[l] ,, X_{1,k}^n[l-(\Ly + \Ld* -1)] }} \label{eq:sec3:sample-stacking_bvDb_bvxb:subeq2}
\end{subgather}

We now concatenate our observed signals sensor-wise, leading us to $\bvy{k}[l]$ defined by
\begin{subalign}{eq:sec3:def_bvy_sensor-stacking}
	\bvy{k}[l]
	& = \tr{ \tup{ \tr{\bvY{1,k}} ,, \tr{\bvY{M,k}} } } \label{eq:sec3:definition_bvyk-l:subeq1}\\
	& = \bvD{k}' \bvx[b]{1,k}'[l] + \bvD{k}'' \bvx[b]{1,k}''[l] + \bvs{k}[l] + \bvr{k}[l]
\end{subalign}
and
\begin{equation}
	\label{eq:sec3:def_bvDk_n}
	\bvD{k}^n = \vtup{\bvD[b]{1,k}^n ,, \bvD[b]{M,k}^n }
\end{equation}
where $\bvy{k}[l]$ is a $\sz{(M\Ly)}{1}$ vector, and $\bvD{k}^n$ is a $\sz{(M\Ly)}{L}$ matrix. $\bvs{k}[l]$ and $\bvr{k}[l]$ are defined similarly to \cref{eq:sec3:definition_bvyk-l:subeq1}. $\bvy{k}[l]$ can also be written as
\begin{equation}
	\bvy{k}[l] = \tr{ \tup{ Y_{1,k}[l] ,, Y_{1,k}[l-\Ly+1] , Y_{2,k}[l] ,, Y_{M,k}[l-\Ly+1] } }
\end{equation}

\subsection{Filtering and the MPDR beamformer}

We want to recover the desired signal at the reference sensor, $X_{1,k}[l] = X_{1,k}'[l] + X_{1,k}''[l]$ (see \cref{eq:sec3:def_ctf_ssbt,eqs:sec3:def_desired_signals_ssbt} with $m=1$), without any distortion. For this, a linear filter $\bvf{k}[l]$ will be employed, producing an estimate $Z_{k}[l]$ of our desired signal, such that
\begin{equations}{eq:sec3:def_filtering_process}
	Z^n_{k}[l]
	& \approx X_{1,k}[l] \\
	& = \he{\bvf{k}}[l] \bvy{k}[l]
\end{equations}
with $\he{(\cdot)}$ being the transposed-complex-conjugate operator. This process can also be interpreted as
\begin{equations}{eq:sec3:convolutive_form_filter}
	Z_{k}[l]
	& = \sum_{m} \he{\bvF{m,k}}[l] \bvy[b]{m,k}[l] \\
	& = \sum_{m} F_{m,k}^*[l] \ast Y_{m,k}[l]
\end{equations}
where $\bvF{m,k}[l]$ are $\sz{L}{1}$ vectors that comprise $\bvf{k}[l]$, each filtering the $m$-th sensor, and $F_{m,k}[l]$ is its signal-form counterpart. In this sense, the filtering process can be interpreted as the sum across all sensors of the convolution between the signal and the observations.

Going back to \cref{eq:sec3:def_filtering_process}, with \cref{eq:sec3:def_bvy_sensor-stacking} we can write
\begin{equations}
	Z_{k}[l] 
%	& = \he{\bvf{k}}[l] \bva{k}' X_{1,k}'[l] + \he{\bvf{k}}[l] \bva{k}'' X_{1,k}''[l] + \he{\bvf{k}}[l] \bvq{k}[l] + \he{\bvf{k}}[l] \bvs{k}[l] + \he{\bvf{k}}[l] \bvr{k}[l] \\
	& = \he{\bvf{k}}[l] \bvD{k}' \bvx[b]{1,k}'[l] + \he{\bvf{k}}[l]\bvD{k}'' \bvx[b]{1,k}''[l] + \he{\bvf{k}}[l] \bvs{k}[l] + \he{\bvf{k}}[l] \bvr{k}[l] \\
	& = X_{f,k}[l] + S_{f,k}[l] + R_{f,k}[l]
\end{equations}
where $X_{f,k}[l]$ is the filtered desired signal, and similarly for all the others. In particular, we have that
\begin{equation}
	\label{eq:sec3:sep_Xfk_desired_signals}
	X_{f,k}[l] = \he{\bvf{k}}[l] \bvD{k}' \bvx[b]{1,k}'[l] + \he{\bvf{k}}[l]\bvD{k}'' \bvx[b]{1,k}''[l]
\end{equation}
where we expose each component of our desired signal. The distortionless constraint can be written as
\begin{equation}
	\label{eq:sec3:hard_distortionless_constriant}
	X_{f,k}[l] = X_{1,k}[l]
\end{equation}
which is equivalent to requiring that each component of $X_{1,k}[l]$ is distortionlessly recovered. From \cref{eq:sec3:sample-stacking_bvDb_bvxb:subeq2}, we have that the desired signal on the current instant is the $(\Delta+1)$-th element of $\bvx[b]{1,k}^n[l]$. Therefore, our distortionless constraint can be written as
\begin{subgather}{eq:sec3:hard_distortionless_constraint_separate}
	\he{\bvf{k}}[l] \bvD{k}' = \tr{\bvi{\Delta}} \label{eq:sec3:hard_distortionless_constraint_separate:subeq1} \\
	\he{\bvf{k}}[l] \bvD{k}'' = \tr{\bv{0}} \label{eq:sec3:hard_distortionless_constraint_separate:subeq2}
\end{subgather}
where $\bvi{\Delta}$ is a $\sz{L}{1}$ vector of zeros except for the $(\Delta+1)$-th entry, which is a $1$, and $\bv{0}$ is a $\sz{L}{1}$ vector of zeros.

For the STFT, only the first constraint of \cref{eq:sec3:hard_distortionless_constraint_separate} is considered, since then we have that $\bvD{k}'' = \bv{0}$ by definition. With this, we write our constraint matrix as
\begin{equation}
	\he{\bvf{k}}[l] \bvC{k} = \tr{\bvi}
\end{equation}
where, for the STFT, $\bvC{k} = \bvD{k}'$ and $\bvi = \bvi{\Delta}$; and, for the SSBT, $\bvC{k} = \bts{\bvD{k}'\,,~\bvD{k}''}$, and $\bvi = \begin{bmatrix}
	\bvi{\Delta} \\ \bv{0}
\end{bmatrix}$. This shows us the second problem with beamforming with the SSBT: while with the STFT only one constraint is necessary to achieve the non-distortionality, two constraints are needed with the SSBT, increasing the beamformer complexity. Furthermore, it is trivial to see that each additional constraint (such as with an LCMV beamformer) on the problem will translate into two constraints for the SSBT.

To minimize the variance of the output signal while obeying the distortionless constraint, a Minimum-Power Distortionless Response (MPDR) beamformer will be used, it being defined as
\begin{equation}
	\label{eq:sec3:minimization_problem_mpdr_hard}
	\bvf{\mpdr_1;k}[l] = \min_{\bvf{k}[l]} \he{\bvf{k}}[l] \bvGa{\alpha;k}[l] \bvf{k}[l]~\text{s.t.}~\he{\bvf{k}}[l] \bvC{k} = \tr{\bvi}
\end{equation}
where
\begin{equation}
	\bvGa{\alpha;k}[l] = (1-\alpha)\bvGa{\bvy{k}}[l] + \alpha \bv{I}
\end{equation}
with $\bvGa{\bvy{k}}[l]$ being the pseudo-correlation matrix of the observed signal $\bvy{k}[l]$ of size $\sz{M\Ly}{M\Ly}$, and $\alpha$ is a regularization parameter. The solution to this minimization problem 
\begin{equation}
	\label{eq:sec3:solution_mpdr_beamformer_hard}
	\bvf{\mpdr_1;k}[l] = \iCorr{\bvy{k}}[l] \bvC{k} \inv{\bts{ \he{\bvC{k}} \iCorr{\bvy{k}}[l] \bvC{k} }} \bvi
\end{equation}

Logically, with the SSBT all conjugate-transpose operations are replaced with simple transposes, as in this transform all signals and matrices are real-valued.

\subsection{Conjugate-frequency filtering}
It is useful to bring \cref{prop:rtfs_are_even-odd_on_frequency} to light. From there, we have that RFR's are an even function on frequency for the frequency-to-frequency portion and odd for the conjugate-frequency (that is, with the SSBT we have that $A_{m,k}'[l] = A_{m,(K-k)}'[l]$ and $A_{m,k}''[l] = -A_{m,(K-k)}''[l]$). Using this, then from our constraint in \cref{eq:sec3:hard_distortionless_constraint_separate:subeq2} we have
\begin{equations}{eq:sec3:conjugate-frequency_null_constraint_equivalence}
	\he{\bvf{K-k}}[l] \bvD{K-k}''
	& = \he{\bvf{K-k}}[l] \pts{-\bvD{k}''} \\
	& = 0
\end{equations}

It is also easy to see that $\Corr{\bvy{k}}[l] = \Corr{\bvy{K-k}}[l]$ (for the SSBT), given all the properties from \cref{app:properties_rft}. Therefore we have that $\bvf{k}[l]$: achieves the non-distortionality constraint for the bin $K-k$, given that $A_{m,k}'[l] = A_{m,(K-k)}'[l]$; it also achieves the null of the conjugate-frequency portion, given the results from \cref{eq:sec3:conjugate-frequency_null_constraint_equivalence}; and it also minimizes the power of the output signal, given that $\Corr{\bvy{k}}[l] = \Corr{\bvy{K-k}}[l]$. Therefore, it is unnecessary to calculate $\bvf{K-k}[l]$, given that $\bvf{k}[l]$ fulfills the minimization problem from \cref{eq:sec3:minimization_problem_mpdr_hard} for the conjugate bin $K-k$ as well.