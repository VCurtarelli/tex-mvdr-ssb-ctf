\section{Signal Model and Beamforming}
\label{sec:signal_model}

Let there be a device that consists of $M$ sensors and a loudspeaker (LS) in a reverberant environment, in which there also is a desired source, both traveling with a speed $c$. We also assume the presence of undesired noise at each sensor. For simplicity we assume that all sources are spatially stationary, although this condition can be easily removed.

We denote $Y_{m,k}[l]$ as the signal at the $m$-th sensor on the time-frequency domain, being represented by
\begin{equation}
	\label{eq:sec3:system_time-freq_domain_base}
	Y_{m,k}[l] = X_{m,k}[l] + S_{m,k}[l] + R_{m,k}[l]
\end{equation}
where $X_{m,k}[l]$ is a desired signal component, $S_{m,k}[l]$ is the undesired loudspeaker signal that is captured by the sensors, and $R_{m,k}[l]$ is uncorrelated white noise present in the sensors. $m$ is the sensor index ($1 \leq m \leq M$), $k$ is the frequency bin index ($0 \leq k < K$), and $l$ is the decimated-time index. We will use a different notation to the one previously used, for ease of reading.

Treating the multiple paths between the desired source and the $m$-th sensor as a system, with the CTF model $X_{m,k}[l]$ can be represented by \cref{eq:sec2:system_ctf_ssbt_output}, as
\begin{equation}
	\label{eq:sec3:def_ctf_ssbt}
	X_{m,k}[l] = A_{m,k}'[l] \ast X_{1,k}'[l] + A_{m,k}''[l] \ast X_{1,k}''[l]
\end{equation}\vspace*{-2em}
\begin{subgather}
	X_{1,k}'[l] = H_{1,k}'[l] \ast X_k[l] \\
	X_{1,k}''[l] = H_{1,k}''[l] \ast X_{K-k}[l]
\end{subgather}
where $X_{1,k}'[l]$ is the portion of the desired signal at the reference sensor of the direct frequency, $X_{1,k}''[l]$ is the portion of the conjugate frequency $K-k$, $H^n_{1,k}[l]$ are the desired signal's transfer functions between source and reference, and $A^n_{m,k}[l]$ are the RTF's between each sensor and the reference. This formulation models both the STFT and the SSBT, as with the STFT we just take $A_{m,k}''[l] = H_{m,k}''[l] = 0$, as there is no cross-over between conjugate frequencies.

Note that $A_{m,k}[l]$ isn't strictly a causal response, depending on the direction of arrival and features of the reverberant environment, as well as relative delays between the sources at each sensor. We will assume that there are $\Delta$ non-causal samples in $A_{m,k}[l]$. It is trivial to see that, for \cref{eq:sec3:def_ctf_ssbt} to be respected, $A_{1,k}'[l] = A_{1,k}''[l] = \delta_{0,l}$, a Kronecker delta at $l=0$.

We consider the delayed signal $X_{m,k}[l+\lambda]$, such that, when expanding the convolutions, we have
\begin{equation}
	X_{m,k}[l+\lambda] = \sum_{\tau} \pts{A_{m,k}'[\tau] X_{1,k}'[l+\lambda-\tau] + A_{m,k}''[\tau] X_{1,k}''[l+\lambda-\tau]}
\end{equation}
Now we explicit the contribution of $X^n_{1,k}[l]$ on the summation, leading us to
\begin{equations}
	X_{m,k}[l+\lambda]
	& = A_{m,k}'[\lambda] X_{1,k}'[l] + A_{m,k}''[\lambda] X_{1,k}''[l] \\
	& + \sum_{\tau\neq\lambda} \pts{A_{m,k}'[\tau] X_{1,k}'[l+\lambda-\tau] + A_{m,k}''[\tau] X_{1,k}''[l+\lambda-\tau]} \\[0.2cm]
	& = A_{m,k}'[\lambda] X_{1,k}'[l] + A_{m,k}''[\lambda] X_{1,k}''[l] + Q_{m,k}[l+\lambda]
\end{equations}
where the first two terms are the contributions of the desired signals $X_{1,k}'[l]$ and $X_{1,k}''[l]$ at the time of interest $l$, and $Q_{m,k}[l+\lambda]$ are the remaining terms of the convolution, which can be regarded as only reverberation. Using this on \cref{eq:sec3:system_time-freq_domain_base} with \cref{eq:sec3:def_ctf_ssbt}, we have that
\begin{equation}
	Y_{m,k}[l+\lambda] = A_{m,k}'[\lambda] X_{1,k}'[l] + A_{m,k}''[\lambda] X_{1,k}''[l] + Q_{m,k}[l+\lambda] + S_{m,k}[l+\lambda] + R_{m,k}[l+\lambda]
\end{equation}

We consider $\Ly$ previous and $\Ly*$ future frames of $Y_{m,k}[l]$, and let $L = \Ly + \Ly* + 1$ the total number of frames. With this, we define $\bvY{m,k}[l]$ as a vector containing those $L$ samples,
\begin{equation}
	\bvY{m,k}[l] = \bvA{m,k}' X_{1,k}'[l] +  \bvA{m,k}'' X_{1,k}''[l] + \bvQ{m,k}[l] + \bvS{m,k}[l] + \bvR{m,k}[l]
\end{equation}
in which
\begin{equation}
	\label{eq:sec3:def_bvY_sample-stacking}
	\bvY{m,k}[l] = \tr{ \tup{ {Y_{m,k}[l+\Ly*]} ,, {Y_{m,k}[l]} ,, {Y_{m,k}[l-\Ly]} } }
\end{equation}
and similarly for all other signals, and
\begin{equation}
	\bvA_{m,k}^n = \tr{\tup{ {A^n_{m,k}[\Ly*]} ,, {A^n_{m,k}[0]} ,, {A^n_{m,k}[-\Ly]} }}
\end{equation}
with all of them being $\sz{L}{1}$ vectors.

Now stacking these signals in a vector sensor-wise, we get
\begin{equation}
	\label{eq:sec3:def_bvy_sensor-stacking}
	\bvy{k}[l] = \bva{k}' X_{1,k}'[l] + \bva{k}'' X_{1,k}''[l] + \bvq{k}[l] + \bvs{k}[l] + \bvr{k}[l]
\end{equation}
with
\begin{equation}
	\bvy{k}[l] = \tr{\tup{ \tr{\bvY{1,k}}[l] ,, \tr{\bvY{M,k}}[l] }}
\end{equation}
and the same for $\bva{k}^n$, $\bvq{k}[l]$, $\bvs{k}[l]$ and $\bvr{k}[l]$, where them all are $\sz{ML}{1}$ vectors.

\subsection{Filtering and the MPDR beamformer}

We want to recover the desired signal at the reference sensor, $X_{1,k}[l] = X_{1,k}'[l] + X_{1,k}''[l]$ (see \cref{eq:sec3:def_ctf_ssbt} with $m=1$), without any distortion. For this, a linear filter $\bvf{k}[l]$ will be employed, producing an estimate $Z_{k}[l]$ of our desired signal, such that
\begin{equations}{eq:sec3:def_filtering_process}
	Z^n_{k}[l]
	& \approx X_{1,k}[l] \\
	& = \he{\bvf{k}}[l] \bvy{k}[l]
\end{equations}
with $\he{(\cdot)}$ being the transposed-complex-conjugate operator. This process can also be interpreted as
\begin{equations}{eq:sec3:convolutive_form_filter}
	Z_{k}[l]
	& = \sum_{m} \he{\bvf[b]{m,k}}[l] \bvy[b]{m,k}[l] \\
	& = \sum_{m} F_{m,k}^*[l] \ast Y_{m,k}[l]
\end{equations}
where $\bvf[b]{m,k}[l]$ is the $\sz{L}{1}$ part of $\bvf{k}[l]$ that filters the $m$-th sensor, and $F_{m,k}[l]$ is its signal-form counterpart. In this sense, the filtering process can be interpreted as the sum across all sensors of the convolution between the signal and the observations.

Going back to \cref{eq:sec3:def_filtering_process}, with \cref{eq:sec3:def_bvy_sensor-stacking} we can write
\begin{equations}
	Z_{k}[l] 
	& = \he{\bvf{k}}[l] \bva{k}' X_{1,k}'[l] + \he{\bvf{k}}[l] \bva{k}'' X_{1,k}''[l] + \he{\bvf{k}}[l] \bvq{k}[l] + \he{\bvf{k}}[l] \bvs{k}[l] + \he{\bvf{k}}[l] \bvr{k}[l] \\
	& = X_{f,k}[l] + Q_{f,k}[l] + S_{f,k}[l] + R_{f,k}[l]
\end{equations}
where $X_{f,k}[l]$ is the filtered-desired signal, and similarly for all the others. In particular, we have that
\begin{equation}
	X_{f,k}[l] = \he{\bvf{k}}[l] \bva{k}' X_{1,k}'[l] + \he{\bvf{k}}[l] \bva{k}'' X_{1,k}''[l]
\end{equation}
from which we can derive two forms of the distortionless constraint. In the first one, we require that
\begin{equation}
	\label{eq:sec3:hard_distortionless_constriant}
	X_{f,k}[l] = X_{1,k}[l]
\end{equation}
which is equivalent to requiring that
\begin{subgather}
	\label{eq:sec3:hard_distortionless_constriant_separate}
	\he{\bvf{k}}[l] \bva{k}' = 1 \\
	\he{\bvf{k}}[l] \bva{k}'' = 1
\end{subgather}
where we ensure that each component of $X_{1,k}[l]$ is distortionlessly recovered. With this, 

 Although this approach is more favorable, it comes with its limitations, since following what was achieved in \cref{subsec:sec2:relative_transfer_functions} we can't estimate appropriately the coefficients that comprise $\bva{k}'$ and $\bva{k}''$.

Another alternative is to require that
\begin{equation}
	\label{eq:sec3:soft_distortionless_constriant}
	\expec{X_{f,k}^2[l]} = \expec{X_{1,k}^2[l]}
\end{equation}
where we ensure only that the estimate's magnitude is the same as that of the original signal, for each frequency bin. Naturally, this implies a loss of information, specifically about the phase. For such, we define a new vector $\bva{k}$, given by
\begin{equation}
	\label{eq:sec3:new_bva_vector_ssbt}
	\bva{k} = \frac{\ar^2 {\bva{k}'}^2 + \ai^2 {\bva{k}''}^2}{\ar^2 + \ai^2}
\end{equation}
where, through the properties and formulas derived in \cref{subsec:sec2:relative_transfer_functions}, we have that the $(L[m-1]+i)$-th element of $\bva{k}$ is
\begin{equation}
	\label{eq:sec3:new_bva_vector_element_def}
	\el{\bva{k}}[(L[m-1]+i)] = \frac{\expec{X_{m,k}[\Ly*-i+l] X_{1,k}[l]}}{\expec{X_{1,k}^2[l]}}
\end{equation}
therefore being independent on our choices of $\ar$ and $\ai$, and depending only on the statistics of the signals. This also has the same format as \cref{eq:sec2:calc_RTF_ft_expec} (except that the complex-conjugate of $X_{1,k}[l]$ is used in the numerator), which is used with the STFT for estimating the coefficients of the steering vector. With the STFT, this formulation has the advantage that it also satisfies the distortionless constraint in \cref{eq:sec3:hard_distortionless_constriant}, which isn't the case for the SSBT. It is easy to see that $\he{\bvf{k}}[l] \bva{k} = 1$ implies \cref{eq:sec3:soft_distortionless_constriant}.

Given that it is feasible to estimate the steering vector from \cref{eq:sec3:new_bva_vector_element_def}, opposite to those that would be necessary for \cref{eq:sec3:hard_distortionless_constriant_separate}, we will use the ``soft'' distortionless constraint from \cref{eq:sec3:new_bva_vector_ssbt,eq:sec3:new_bva_vector_element_def}.

To minimize the variance of the output signal while obeying the distortionless constraint, a Minimum-Power Distortionless Response (MPDR) beamformer will be used, it being defined as
\begin{equation}
	\label{eq:sec3:minimization_problem_mpdr}
	\bvf{\mpdr;k}[l] = \min_{\bvf{k}[l]} \he{\bvf{k}}[l] \Corr{\bvy{k}}[l] \bvf{k}[l]~\text{s.t.}~\he{\bvf{k}}[l] \bva{k} = 1
\end{equation}
where $\Corr{\bvy{k}}[l]$ is the correlation matrix of the observed signal $\bvy{k}[l]$. The solution to this minimization problem 
\begin{equation}
	\label{eq:sec3:solution_mpdr_beamformer}
	\bvf{\mpdr;k}[l] = \frac{\iCorr{\bvy{k}}[l] \bva{k}}{ \he{\bva{k}} \iCorr{\bvy{k}}[l] \bva{k} }
\end{equation}

Obviously, with the SSBT all conjugate-transpose operations are replaced with simple transposes, as in this transform all signals and matrices are real-valued.
%\vspace{1em}
%\hrule
%\vspace*{2em}
%
%Going back to \cref{eq:sec3:def_filtering_process}, with \cref{eq:sec3:def_bvy_sensor-stacking} we can write
%\begin{equation}
%	Z_{k}[l] = \he{\bvf{k}}[l] \bvA{k} \bvx[b]{1,k}[l] + \he{\bvf{k}}[l] \bvB{k} \bvs[b]{1,k}[l] + \he{\bvf{k}}[l] \bvr{k}[l] + \he{\bvf{k}}[l] \bvq{k}[l]
%\end{equation}
%From this, we easily see that to achieve a distortionless response from the desired signal, we must have that $\he{\bvf{k}}[l] \bvA{k} \bvx[b]{1,k}[l] = X_{1,k}[l]$, and therefore the distortionless constraint is given by
%\begin{equation}
%	\he{\bvf{k}}[l] \bvA{k} = \tr{\bvi{\Delta}}
%\end{equation}
%where $\bvi{\Delta}$ is a $\sz{L}{1}$ vector of zeroes, except for the $\Delta$-th entry which is a $1$. %For this to be true, we assume that $\bvq{k}[l]$ is uncorrelated to $\bvx[b]{1,k}[l]$, which may not be true depending on the values of $\Delta$ and $L_A$ chosen, and the characteristics of the environment.

%To minimize the variance of the output signal while obeying the distortionless constraint, a Minimum-Power Distortionless Response (MPDR) beamformer will be used, it being defined as
%\begin{equation}
%	\label{eq:sec3:minimization_problem_mpdr}
%	\bvf{\mpdr;k}[l] = \min_{\bvf{k}[l]} \he{\bvf{k}}[l] \Corr{\bvy{k}}[l] \bvf{k}[l]~\text{s.t.}~\he{\bvf{k}}[l] \bvA{k} = \tr{\bvi{\Delta}}
%\end{equation}
%where $\Corr{\bvy{k}}[l]$ is the correlation matrix of the observed signal $\bvy{k}[l]$. The solution to this minimization problem 
%\begin{equation}
%	\label{eq:sec3:solution_mpdr_beamformer}
%	\bvf{\mpdr;k}[l] = \iCorr{\bvy;k}[l] \bvA{k} \inv{\bts{ \he{\bvA{k}} \iCorr{\bvy;k}[l] \bvA{k} }} \bvi{\Delta}
%\end{equation}