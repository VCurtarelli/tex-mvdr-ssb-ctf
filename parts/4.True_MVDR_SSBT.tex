\section{True-MPDR with the Single-Sideband Transform}
\label{sec:true_mpdr_ssbt}

When carelessly using any of the established methods with the SSBT, the distortionless constraint ensures that the beamformer avoids causing distortion exclusively within the SSBT domain. However, as explained in \cref{sec:stft_and_ssbt} the SSBT beamformer must be carefully constructed to achieve the desired effects, such as the distortionless constraint.

We thus propose a framework for the SSBT in which we consider the bins $k$ and $K-k$ simultaneously, since from \cref{eq:sec2:equivalence_ssbt_stft} they both contribute to the $k$-th bin in the STFT domain. We define $\bvy'[l,k]$ as
\begin{equation}
	\bvy'[l,k] = \vtup{ {\bvy[l,k]} , {\bvy[l, K-k]} }\SubSize{2M}{1}
\end{equation}
from which we define $\Corr{\bvy'}[l,k]$ as its correlation matrix. Under this idea, our filter $\bvf[l,k]$ is a $\sz{2M}{1}$ vector, with the first $M$ values being for the $k$-th bin, and the last $M$ values for the $[K-k]$-th bin. We let the STFT-equivalent filter for the SSBT beamformer $\bvf[l,k]$ be $\bvf{\F}[l,k]$, given by
\begin{equation}
	\label{eq:sec4:conversion_beamformer_ssbt_to_stft}
	\bvf{\F}[l,k] = \bvLa \bvf[l,k]
\end{equation}
in which
\def\facA{e^{-\j\frac{3\pi}{4}}}
\def\facB{e^{\j\frac{3\pi}{4}}}
\begin{equation}
	\bvLa = \frac{1}{\Sqrt{2}} \begin{bmatrix}
		\facA 	& 0 		& \cdots & 0  		& \facB 	& 0 		& \cdots 	& 0 	\\
		0 		& \facA 	& \cdots & 0  		& 0 		& \facB 	& \cdots 	& 0 	\\
		\vdots 	& \vdots 	& \ddots & \vdots 	& \vdots 	& \ddots 	& \vdots  	& 0 	\\
		0 		& 0 		& \cdots & \facA 	& 0 		& 0 		& \cdots	& \facB
	\end{bmatrix}\SubSize{M}{2M}
\end{equation}

From \cref{eq:sec4:conversion_beamformer_ssbt_to_stft} the constraint matrix within the SSBT domain becomes
\begin{subgather}
	\label{eq:sec4:distortionless_constraint_in_ssbt}
	\he{\bvf}[l,k] \bvd{x;\S}[k] = 1 \\
    \bvd{x;\S}[k] = \he{\bvLa} \bvd{x;\F}[k]
\end{subgather}
where $\bvd{x;\F}[l,k]$ is the constraint matrix within the STFT domain, and $\bvd{x;\S}[k]$ is the new constraint matrix within the SSBT domain. %Since $\bvLa$ was chosen to be the matrix-equivalent of \cref{eq:sec2:equivalence_ssbt_stft}, then $\bvPh[k]$ is composed of the equivalent vectors, but within the SSBT domain.

In this scheme, our minimization problem becomes
\begin{equation}
	\label{eq:true-mpdr_ssbt_beamformer}
	\bvf_{\mpdr}[l,k] = \min_{\bvf[l,k]} \he{\bvf}[l,k] \Corr{\bvy'}[l,k] \bvf[l,k]~\text{s.t.}~\he{\bvf}[l,k] \bvd{x;\S}[k] = 1
\end{equation}

Although $\Corr{\bvy'}[l,k]$ is a matrix with real entries, $\bvd{x;\S}[k]$ is complex-valued, and thus is the solution to \cref{eq:true-mpdr_ssbt_beamformer}, contradicting the purpose of utilizing the SSBT.

\subsection{Real-valued true-MPDR beamformer with SSBT}

To ensure the desired behavior of $\bvf[l,k]$ being real-valued, an additional constraint is necessary. By forcing $\bvf[l,k]$ to have real entries, from \cref{eq:sec4:distortionless_constraint_in_ssbt} we trivially have that
\begin{subalign}
	\tr{\bvf}[l,k] \real{\bvd{x;\S}[k]} & = 1 \\
	\tr{\bvf}[l,k] \imag{\bvd{x;\S}[k]} & = 0
\end{subalign}
which can be put in matricial form as $\tr{\bvf}[l,k] \bvD{x}[k] = \tr{\bvi{2}}$, with
\begin{subgather}{eq:sec4:matrix_form_tMPDR}
	\begin{split}
		\bvD{x}[k]
		& = \tup{ \real{\bvd{x;\S}[k]} , \imag{\bvd{x;\S}[k]} }\SubSize{2M}{2} \\
		& = \tup{ \bvd{x;\re}[k] , \bvd{x;\im}[k] }
	\end{split} \\
	\bvi{2} = \tr{\tup{1 , 0}}
\end{subgather}

Therefore, the minimization problem from \cref{eq:true-mpdr_ssbt_beamformer} becomes
\begin{equation}
	\label{eq:sec4:minimization_problem_mpdr_tssbt}
	\bvf_{\mpdr}[l,k] = \min_{\bvf[l,k]} \tr{\bvf}[l,k] \Corr{\bvy'}[l,k] \bvf[l,k]~\text{s.t.}~\tr{\bvf}[l,k] \bvD{x}[k] = \tr{\bvi{2}}
\end{equation}
whose formulation is the same as of the Linearly-Constrained Minimum Power (LCMP) beamformer, and thus its solution is
\begin{equation}
	\label{eq:sec4:solution_mpdr_beamformer_tssbt}
	\bvf_{\mpdr}[l,k] = \iCorr{\bvy'}[l,k] \bvD{x}[k] \inv{\pts{ \tr{\bvD{x}}[k] \iCorr{\bvy'}[l,k] \bvD{x}[k] }} \bvi{2}
\end{equation}
Using \cref{eq:sec4:conversion_beamformer_ssbt_to_stft}, we can obtain the desired beamformer $\bvf{\F;\mpdr}[l,k]$, transformed to the STFT domain.

Here onward we will omit the $[k]$ and $[l,k]$ indices for clarity, except for definitions. Using \cref{eq:sec4:matrix_form_tMPDR}, we can write
\begin{equation}
	\tr{\bvD{x}} \iCorr{\bvy'} \bvD{x} =
	\begin{bmatrix}
		\tr{\bvd{x;\re}} \iCorr{\bvy'} \bvd{x;\re} & \tr{\bvd{x;\re}} \iCorr{\bvy'} \bvd{x;\im} \\
		\tr{\bvd{x;\re}} \iCorr{\bvy'} \bvd{x;\im} & \tr{\bvd{x;\im}} \iCorr{\bvy'} \bvd{x;\im}
	\end{bmatrix}
\end{equation}
With this,
\begin{subgather}
	\inv{\pts{\tr{\bvD{x}} \iCorr{\bvy'} \bvD{x}}} = 
	\begin{bmatrix}
		  \tr{\bvd{x;\im}} \iCorr{\bvy'} \bvd{x;\im} & - \tr{\bvd{x;\re}} \iCorr{\bvy'} \bvd{x;\im} \\
		- \tr{\bvd{x;\re}} \iCorr{\bvy'} \bvd{x;\im} &   \tr{\bvd{x;\re}} \iCorr{\bvy'} \bvd{x;\re}
	\end{bmatrix} \cdot \frac{1}{\det{\tr{\bvD{x}} \iCorr{\bvy'} \bvD{x}}} \\[0.5cm]
	\det{\tr{\bvD{x}} \iCorr{\bvy'} \bvD{x}} = \tr{\bvd{x;\re}} \iCorr{\bvy'} \bvd{x;\re}\tr{\bvd{x;\im}} \iCorr{\bvy'} \bvd{x;\im} - \tr{\bvd{x;\re}} \iCorr{\bvy'} \bvd{x;\im} \tr{\bvd{x;\re}} \iCorr{\bvy'} \bvd{x;\im}
\end{subgather}

Going one step further,
\begin{equation}
	\inv{\pts{\tr{\bvD{x}} \iCorr{\bvy'} \bvD{x}}} \bvi{2} = 
	\begin{bmatrix}
		  \tr{\bvd{x;\im}} \iCorr{\bvy'} \bvd{x;\im} \\
		- \tr{\bvd{x;\re}} \iCorr{\bvy'} \bvd{x;\im}
	\end{bmatrix} \cdot \frac{1}{\det{\tr{\bvD{x}} \iCorr{\bvy'} \bvD{x}}}
\end{equation}
and thus
\begin{equation}
	\bvD{x} \inv{\pts{\tr{\bvD{x}} \iCorr{\bvy'} \bvD{x}}} \bvi{2} = \frac{\bvd{x;\re} \tr{\bvd{x;\im}} \iCorr{\bvy'} \bvd{x;\im} - \bvd{x;\im} \tr{\bvd{x;\re}} \iCorr{\bvy'} \bvd{x;\im}}{\det{\tr{\bvD{x}} \iCorr{\bvy'} \bvD{x}}}
\end{equation}

Finally,
\begin{equation}
	\bvf{\mpdr} = \frac{\iCorr{\bvy'} \bvd{x;\re} \tr{\bvd{x;\im}} \iCorr{\bvy'} \bvd{x;\im} - \iCorr{\bvy'} \bvd{x;\im} \tr{\bvd{x;\re}} \iCorr{\bvy'} \bvd{x;\im}}{\tr{\bvd{x;\re}} \iCorr{\bvy'} \bvd{x;\re}\tr{\bvd{x;\im}} \iCorr{\bvy'} \bvd{x;\im} - \tr{\bvd{x;\re}} \iCorr{\bvy'} \bvd{x;\im} \tr{\bvd{x;\re}} \iCorr{\bvy'} \bvd{x;\im}}
\end{equation}

Denoting $\bvOm \equiv \bvOm[l,k]$ as
\begin{equation}
	\label{eq:sec4:def_bvOmega}
	\bvOm \defas \iCorr{\bvy'} \pts{\bvd{x;\re} \tr{\bvd{x;\im}} - \bvd{x;\im} \tr{\bvd{x;\re}} } \iCorr{\bvy'}
\end{equation}
then we finally arrive at the final version of our MPDR beamformer with the SSBT,
\begin{equation}
	\label{eq:sec4:cf_solution_mpdr_beamformer_tssbt}
	\bvf{\mpdr}[l,k] = \frac{\bvOm[l,k]\, \bvd{x;\im}[k]}{ \tr{\bvd{x;\re}[k]} \,\bvOm[l,k]\, \bvd{x;\im}[k]}
\end{equation}

This equation is advantageous since it is similar to the MPDR's formulation for the STFT, given in \cref{eq:sec3:solution_mpdr_beamformer}. This allows us to study both beamformers similarly, given that their expressions are analogous.

\input{figures/io_input/colors_6.tex}
\NewDocumentCommand{\filename}{m}{%
	\small{\texttt{#1}}
}
\let\mc\multicolumn
\subsection{Comparison between beamformers}
\label{sec:results}

In the simulations\footnote{Code is available at \url{https://github.com/VCurtarelli/py-ssb-ctf-bf}.}, we employ a sampling frequency of $16\si{\kilo\hertz}$. Room impulse responses were generated using Habets' RIR generator \cite{habets_rir-generator}, and signals were selected from the SMARD database \cite{smard_database}.

The room's dimensions are $4\m \times 6\m \times 3\m$ (width $\times$ length $\times$ height), with a reverberation time of $0.3\si{\second}$.The device composed of the loudspeaker + sensors is centered at $(2\m,~2\m,~1\m)$. Its sensors are located in a circular array with radius of $8\si{\centi\meter}$, all omnidirectional and of flat frequency response. The positions and signals used for the sources are in \cref{tab:sec4:information_position_sources}. Although both interfering and noise signals are the same, they were taken starting on different timestamps, to ensure they are uncorrelated. All signals were resampled to the desired sampling frequency of $16\si{\kilo\hertz}$.

\begin{table}[H]
	\centering
	\begin{tabular}{rll}
		Source & Position 				& Signal \\
		\hline\vphantom{$\tilde{d}$}
		$x[n]$ & $(2\m,~1\m,~1\m)$ 		& \filename{50\_male\_speech\_english\_ch8\_OmniPower4296.flac} \\
		$s[n]$ & $(2\m,~2\m,~1\m)$ 		& \filename{69\_abba\_ch8\_OmniPower4296.flac} \\
		$w[n]$ & $(2\m,~5.8\m,~2.8\m)$ 	& \filename{wgn\_48kHz\_ch8\_OmniPower4296.flac} \\
		$r[n]$ & \mc{1}{c}{$\sim$}		& \filename{wgn\_48kHz\_ch8\_OmniPower4296.flac}
	\end{tabular}
	\caption{Source information for the simulations.}
	\label{tab:sec4:information_position_sources}
\end{table}
%
At the reference sensor (the one at $(2\m,~2\m,~1.08\m)$), the SNR for the loudspeaker's, interfering, and noise signals are respectively $-15\dB$, $10\dB$ and $30\dB$. For the transforms, Hann windows were used, with a length of 32 samples/window and an overlap of $50\%$. The beamformers were calculated every 200 frames (equivalent to every $0.2\si{\second}$), and used up to the previous 1000 samples to estimate the correlation matrices.

In line plots, STFT is presented in red with continuous lines, N-SSBT in green with dashed lines, and T-SSBT in blue with dotted lines. The output metrics were averaged over 200 frames and presented every 100 windows, for a better visualization.
%We compare filters obtained through the STFT and SSBT transforms. N-SSBT uses \cref{eq:sec3:solution_mpdr_beamformer} to (naively) calculate the SSBT beamformer, and T-SSBT will denote the beamformer obtained via the true-distortionless MPDR from \cref{sec:true_mpdr_ssbt}. Performance analysis is conducted via the STFT domain, with the SSBT beamformers being converted into it. In line plots, STFT is presented in red, N-SSBT in green, and T-SSBT in blue. The output metrics were averaged over 20 windows, to facilitate visualization.


\input{figures/io_input/aux_data_32.tex}
\begin{figure}[H]
\begin{subfigure}{\textwidth}
	\centering
	\input{figures/lineplot_dsrf_32_n15_acc.tex}
	\caption{Per-window broadband DSRF.}
	\label{subfig:lineplot_dsrf_32_n15_acc}
\end{subfigure}\\[1em]
\begin{subfigure}{\textwidth}
	\centering
	\input{figures/lineplot_erle_32_n15_acc.tex}
	\caption{Per-window broadband ERLE.}
	\label{subfig:lineplot_erle_32_n15_acc}
\end{subfigure}\\[1em]
\begin{subfigure}{\textwidth}
	\centering
	\input{figures/lineplot_nsrf_32_n15_acc.tex}
	\caption{Per-window broadband NSRF.}
	\label{subfig:lineplot_nsrf_32_n15_acc}
\end{subfigure}\\[1em]
\centering\ref*{dsrf_lineplot_32_n15_acc}
\caption{Output metrics for the beamformers.}
\label{fig:lineplots_32_n15_acc}
\end{figure}

From \cref{subfig:lineplot_dsrf_32_n15_acc}, we see that all beamformers had a negligible distortion (notice the y-axis scale), however the distortion for the STFT and T-SSBT beamformers was still closer to zero.

From the ERLE results in \cref{subfig:lineplot_erle_32_n15_acc} it is noticeable that the STFT and T-SSBT beamformers had a similar performance (arguably with the T-SSBT being marginally better), both outperforming the N-SSBT beamformer's results by approx. $5\dB$.

A similar result can be seen in \cref{subfig:lineplot_nsrf_32_n15_acc} for the NSRF, however in this regard the STFT had a minimal margin over the T-SSBT, and their gap compared to the N-SSBT wasn't as prominent, although still visible.