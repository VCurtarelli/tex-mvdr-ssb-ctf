\input{figures/io_input/colors_6.tex}
\NewDocumentCommand{\filename}{m}{%
	\small{\texttt{#1}}
}
\let\mc\multicolumn
\section{Comparisons and simulations}
\label{sec:results}

In the simulations\footnote{Code is available at \url{https://github.com/VCurtarelli/py-ssb-ctf-bf}.}, we employ a sampling frequency of $16\si{\kilo\hertz}$. Room impulse responses were generated using Habets' RIR generator \cite{habets_rir-generator}, and signals were selected from the SMARD database \cite{smard_database}. In all cases we will use $\Ld = \Ly$ and $\Delta = 0$; that is, we don't use any non-causal frames, and we consider as many frame samples as RIR samples.

The room's dimensions are $4\m \times 6\m \times 3\m$ (width $\times$ length $\times$ height), with a reverberation time of $0.3\si{\second}$. The device composed of the loudspeaker + sensors is centered at $(3\m,~4\m,~1\m)$, being comprised of $M=8$ sensors arranged in a circular array with radius of $8\si{\centi\meter}$, and all are omnidirectional of flat frequency response. The positions and signals used for the sources are in \cref{tab:sec4:information_position_sources}. The room's layout is in \cref{fig:room_layout}, where in green we have the desired source (assumed to be omnidirectional), and in red the device, with the $8$ sensors and the loudspeaker on the center.

\begin{table}[H]
	\centering
	\begin{tabular}{rll}
		Source & Position 				& Signal \\
		\hline\vphantom{$\tilde{d}$}
		$x[n]$ & $(2\m,~5\m,~1.8\m)$ 	& \filename{50\_male\_speech\_english\_ch8\_OmniPower4296.flac} \\
		$s[n]$ & $(3\m,~4\m,~1\m)$ 		& \filename{69\_abba\_ch8\_OmniPower4296.flac} \\
		$r[n]$ & \mc{1}{c}{$\sim$}		& \filename{wgn\_48kHz\_ch8\_OmniPower4296.flac}
	\end{tabular}
	\caption{Source information for the simulations.}
	\label{tab:sec4:information_position_sources}
\end{table}\vspace*{-2em}

All signals were resampled to the desired sampling frequency of $16\si{\kilo\hertz}$. For the transforms, Hamming windows were used, with a length of 32 samples/window and an overlap of $50\%$. We also the regularization parameter $\alpha = 1e^{-4}$, just enough to control the WNG. The beamformers were calculated once for the whole signal, for faster processing and ease to compare the results. We will compare the two transforms exposed, the STFT and the SSBT, for a varying set of conditions on the signals and variables considered.

In the line plots, STFT results are presented in red lines with circles and SSBT results in green lines with triangles. Results for an accurate RFR (that is, assuming we know precisely all $A_{m,k}'[l]$ and $A_{m,k}''[l]$) are in continuous lines, and for estimate RFR (via \cref{eq:sec2:calc_RTF_ft_expec,eqs:sec2:calc_RTF_rft_expec}) are in darker dashed lines. The output metrics were averaged over 200 frames and presented every 100 windows, for a smoother visualization.

\begin{figure}[!ht]
	\centering
	\includesvg[width=0.7\linewidth]{figures/drawing/room_layout.svg}
	\caption{Room layout for simulations.}
	\label{fig:room_layout}
\end{figure}
%

\subsection{Metrics of interest}

The main objective of the filters compared is the reduction of the loudspeaker's signal, while preserving the desired signal without distortion. Along this, although our filter isn't designed to reduce the white noise, a minimal enhancement of it would also be of interest. The loudspeaker's signal minimization will be measured through the echo reduction loss enhancement (ERLE, or $\erle$), the maintenance of the desired signal through the desired signal reduction factor (DSRF, or $\dsrf$), and the reduction of the white noise through the white noise gain (WNG, or $\wng$). We are will also observe the directivity index (DI, or $\di$), which measures the behavior of the beamformer when it would be located in a spherical anisotropic noise field. Respectively, these metrics in their time-dependent broadband formulations are given by
\begin{subgather}
	\dsrf[l] = \frac{\sum_{k}\abs{X_{1,k}[l]}^2}{\sum_{k}\abs{X_{f,k}[l]}^2} \\
	\erle[l] = \frac{\sum_{k}\abs{S_{1,k}[l]}^2}{\sum_{k}\abs{S_{f,k}[l]}^2} \\
	\wng[l] = \frac{\sum_{k}\abs{R_{1,k}[l]}^2}{\sum_{k}\abs{R_{f,k}[l]}^2} \\
	\di[l] = \frac{\sum_{k} \abs{\he{\bvf{k}}[l] \bvd{k}[l]}^2}{\sum_{k} \he{\bvf{k}}[l] \bvGa[b]{k}[l] \bvf{k}[l]}
\end{subgather}
in which $\bvGa[b]{k}[l]$ is the spherical anisotropic noise field correlation matrix \cite{habets_generating_2007} and $\bvd{k}[l]$ is the steering vector between the desired source and the sensor array, both assuming a far-end free field environment. We are also interested in a time-average broadband formulation for these metrics, this being given by
\begin{subgather}
	\dsrf = \frac{\sum_{l,k}\abs{X_{1,k}[l]}^2}{\sum_{l,k}\abs{X_{f,k}[l]}^2} \\
	\erle = \frac{\sum_{l,k}\abs{S_{1,k}[l]}^2}{\sum_{l,k}\abs{S_{f,k}[l]}^2} \\
	\wng = \frac{\sum_{l,k}\abs{R_{1,k}[l]}^2}{\sum_{l,k}\abs{R_{f,k}[l]}^2} \\
	\di = \frac{\sum_{l,k} \abs{\he{\bvf{k}}[l] \bvd{k}[l]}^2}{\sum_{l,k} \he{\bvf{k}}[l] \bvGa[b]{k}[l] \bvf{k}[l]}
\end{subgather}

\subsection{Basic comparison}
In this scenario, at the reference sensor (assumed to be the one at $(3\m,~1.92\m,~1\m)$), the SNR for the loudspeaker's and noise signals are respectively $-15\dB$ and $30\dB$. These will be referred as Signal-to-Echo and Signal-to-Noise Ratios (SER and SNR) in that order. We will use $\Ly = 1$ and $\Ly = 16$ to illustrate two different cases in terms of samples used, one where we consider only the latest sample for each sensor, and another where we have sufficient samples for a (empirically) good enough performance.

\input{figures/io_input/aux_data_32.tex}
\begin{figure}[!ht]
	\centering
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__DSRF_l__iSER_n15__Ly_1.tex}
		\caption{Per-window broadband DSRF, $\Ly = 1$.}
		\label{subfig:lineplot__DSRF_l__iSER_n15__Ly_1}
	\end{subfigure}\hfill
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__DSRF_l__iSER_n15__Ly_16.tex}
		\caption{Per-window broadband DSRF, $\Ly = 16$.}
		\label{subfig:lineplot__DSRF_l__iSER_n15__Ly_16}
	\end{subfigure}\\[1em]
	%
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__ERLE_l__iSER_n15__Ly_1.tex}
		\caption{Per-window broadband ERLE, $\Ly = 1$.}
		\label{subfig:lineplot__ERLE_l__iSER_n15__Ly_1}
	\end{subfigure}\hfill
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__ERLE_l__iSER_n15__Ly_16.tex}
		\caption{Per-window broadband ERLE, $\Ly = 16$.}
		\label{subfig:lineplot__ERLE_l__iSER_n15__Ly_16}
	\end{subfigure}\\[1em]
	%
		\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__WNG_l__iSER_n15__Ly_1.tex}
		\caption{Per-window broadband WNG, $\Ly = 1$.}
		\label{subfig:lineplot__WNG_l__iSER_n15__Ly_1}
	\end{subfigure}\hfill
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__WNG_l__iSER_n15__Ly_16.tex}
		\caption{Per-window broadband WNG, $\Ly = 16$.}
		\label{subfig:lineplot__WNG_l__iSER_n15__Ly_16}
	\end{subfigure}\\[1.5em]
	\ref*{timeplot_legend}
	\caption{Output metrics for the beamformers over time, in the base scenario.}
	\label{fig:lineplot__iSER_n15__Ly_1}
\end{figure}

\subsection{Comparison for different $\Ly$}
\begin{figure}[H]
	\centering
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__DSRF__iSER_n15__Ly_var.tex}
		\caption{Time-average broadband DSRF for varying $\Ly$.}
		\label{subfig:lineplot__DSRF__iSER_n15__Ly_var}
	\end{subfigure}\\[1em]
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__ERLE__iSER_n15__Ly_var.tex}
		\caption{Time-average broadband ERLE for varying $\Ly$.}
		\label{subfig:lineplot__ERLE__iSER_n15__Ly_var}
	\end{subfigure}\\[1em]
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__WNG__iSER_n15__Ly_var.tex}
		\caption{Time-average broadband WNG for varying $\Ly$.}
		\label{subfig:lineplot__WNG__iSER_n15__Ly_var}
	\end{subfigure}\\[1em]
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__DI__iSER_n15__Ly_var.tex}
		\caption{Time-average broadband DI for varying $\Ly$.}
		\label{subfig:lineplot__DI__iSER_n15__Ly_var}
	\end{subfigure}\\[1em]
	\ref*{lyplot_legend}
	\caption{Output metrics for the beamformers for varying input $L_Y$'s.}
	\label{fig:lineplot__iSER_n15__Ly_var}
\end{figure}

\subsection{Comparison for different iSER}
\begin{figure}[H]
	\centering
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__DSRF__iSER_var__Ly_1.tex}
		\caption{Time-average broadband DSRF for varying $\iser$.}
		\label{subfig:lineplot__DSRF__iSER_var__Ly_1}
	\end{subfigure}\hfill
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__DSRF__iSER_var__Ly_16.tex}
		\caption{Time-average broadband DSRF for varying $\iser$.}
		\label{subfig:lineplot__DSRF__iSER_var__Ly_16}
	\end{subfigure}\\[1em]
	%
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__ERLE__iSER_var__Ly_1.tex}
		\caption{Time-average broadband ERLE for varying $\iser$.}
		\label{subfig:lineplot__ERLE__iSER_var__Ly_1}
	\end{subfigure}\hfill
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__ERLE__iSER_var__Ly_16.tex}
		\caption{Time-average broadband ERLE for varying $\iser$.}
		\label{subfig:lineplot__ERLE__iSER_var__Ly_16}
	\end{subfigure}\\[1em]
	%
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__WNG__iSER_var__Ly_1.tex}
		\caption{Time-average broadband WNG for varying $\iser$.}
		\label{subfig:lineplot__WNG__iSER_var__Ly_1}
	\end{subfigure}\hfill
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__WNG__iSER_var__Ly_16.tex}
		\caption{Time-average broadband WNG for varying $\iser$.}
		\label{subfig:lineplot__WNG__iSER_var__Ly_16}
	\end{subfigure}\\[1em]
	%
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__DI__iSER_var__Ly_1.tex}
		\caption{Time-average broadband DI for varying $\iser$.}
		\label{subfig:lineplot__DI__iSER_var__Ly_1}
	\end{subfigure}\hfill
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__DI__iSER_var__Ly_16.tex}
		\caption{Time-average broadband DI for varying $\iser$.}
		\label{subfig:lineplot__DI__iSER_var__Ly_16}
	\end{subfigure}\\[1em]
	\ref*{timeplot_legend}
	\caption{Output metrics for the beamformers for varying input SERs.}
	\label{fig:lineplot__iSER_var__Ly_1}
\end{figure}

\subsection{Comparison for different $N$}

\begin{figure}[!ht]
	\centering
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__DSRF__N_var__iSER_n15__Ly_1.tex}
		\caption{Per-window broadband DSRF, $\Ly = 1$.}
		\label{subfig:lineplot__DSRF__N_var__iSER_n15__Ly_1}
	\end{subfigure}\\[1em]
	%
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__ERLE__N_var__iSER_n15__Ly_1.tex}
		\caption{Per-window broadband ERLE, $\Ly = 1$.}
		\label{subfig:lineplot__ERLE__N_var__iSER_n15__Ly_1}
	\end{subfigure}\\[1em]
	%
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__WNG__N_var__iSER_n15__Ly_1.tex}
		\caption{Per-window broadband WNG, $\Ly = 1$.}
		\label{subfig:lineplot__WNG__N_var__iSER_n15__Ly_1}
	\end{subfigure}\\[1em]
	%
	\begin{subfigure}{0.48\textwidth}
		\centering
		\input{figures/lineplot__DI__N_var__iSER_n15__Ly_1.tex}
		\caption{Per-window broadband WNG, $\Ly = 1$.}
		\label{subfig:lineplot__DI__N_var__iSER_n15__Ly_1}
	\end{subfigure}\\[1.5em]
	\ref*{timeplot_legend}
	\caption{Output metrics for the beamformers over time, in the base scenario.}
	\label{fig:lineplot__N_var__iSER_n15__Ly_1}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Result analysis}

In all figures, we see that the STFT filter had a better performance than the SSBT one, either comparing estimate-on-estimate or accurate-on-accurate, or strictly outperforming it. The only situation in which the opposite occurs is in terms of ERLE, for high input SER, and $\Ly = 1$ (\cref{subfig:lineplot__ERLE__iSER_var__Ly_1}). 

For the STFT, the accurate RFR and estimate RFR (light and dark red results respectively) are usually similar, with each having better performances for different conditions. Unfortunately, the same isn't truee for the SSBT results.

While the SSBT performance for an accurate RFR is similar to that of the STFT for the same condition for most results (mostly being outperformed, but usually not by much), the same isn't true for an estimated RFR. In fact, we can see that for all DSRF results the estimated RFR SSBT results are completely subpar, only geting close to acceptable levels for high $N$ (\cref{subfig:lineplot__DSRF__N_var__iSER_n15__Ly_1}). This corroborates that which was exposed in \cref{subsec:sec2:rfr_estimation_time-freq_transforms} where, with high number of samples in the transform, the impact of neighboring frequencies on the RFR estimation decreases, as well as the impact of different frames is nullified by considering $N = 1$ (that is, a multiplicative filter, instead of a convolutive one).