\input{figures/io_input/colors_6.tex}
\NewDocumentCommand{\filename}{m}{%
	\small{\texttt{#1}}
}
\input{figures/io_input/aux_data_32.tex}
\let\mc\multicolumn
\section{Comparisons and simulations}
\label{sec:results}

In the simulations\footnote{Code is available at \url{https://github.com/VCurtarelli/py-ssb-ctf-bf}.}, we employ room impulse responses that were generated using Habets' RIR generator \cite{habets_rir-generator} and signals that were selected from the SMARD database \cite{smard_database}. In all cases we use $\Ld = \Ly$ and $\Delta = 0$; with this, we disregard any non-causal frames and consider as many frame samples as RIR samples.

The room's dimensions are $4\m \times 6\m \times 3\m$ (width $\times$ length $\times$ height), with a reverberation time of $0.3\si{\second}$. The device composed of the loudspeaker + sensors is centered at $(3\m,~4\m,~1\m)$, being comprised of $M=8$ sensors arranged in a circular array with a radius of $8\si{\centi\meter}$, and all sensors are omnidirectional of flat frequency response. The reference sensor is the one positioned at $(3\m,~1.92\m,~1\m)$. The positions and signals used for the sources are exposed in \cref{tab:sec4:information_position_sources}. The room's layout is in \cref{fig:room_layout}, where in green we have the desired source (assumed to be omnidirectional), and in red the device, with the $8$ sensors and the loudspeaker on the center. We set the input Signal-to-Noise Ratio (iSNR) for the white Gaussian source to $\isnr = 30\dB$, and initially the input Signal-to-Echo Ratio (iSER) for the interfering loudspeaker source to $\iser = -15\dB$. The latter called echo, given that it is a feedback path between the sensors and the undesired loudspeaker source, which are all mounted on the same device.

\begin{table}[H]
	\centering
	\begin{tabular}{rll}
		Source & Position 				& Signal \\
		\hline\vphantom{$\tilde{d}$}
		$x[n]$ & $(2\m,~5\m,~1.8\m)$ 	& \filename{50\_male\_speech\_english\_ch8\_OmniPower4296.flac} \\
		$s[n]$ & $(3\m,~4\m,~1\m)$ 		& \filename{69\_abba\_ch8\_OmniPower4296.flac} \\
		$r[n]$ & \mc{1}{c}{$\sim$}		& \filename{wgn\_48kHz\_ch8\_OmniPower4296.flac}
	\end{tabular}
	\caption{Source information for the simulations.}
	\label{tab:sec4:information_position_sources}
\end{table}\vspace*{-2em}

All signals were resampled to the desired sampling frequency of $16\si{\kilo\hertz}$. Hamming windows with 32 samples per window were used for the transform and an overlap of $50\%$. We empirically set the regularization parameter $\alpha = 1e^{-4}$, just enough to control the gain in SNR. Although the developments allowed for a time-variant beamformer, we designed a single filter for the whole signal, favoring a faster processing time and ease of comparing the results. We will compare filters obtained via the two exposed transforms for varying conditions on the signals and variables considered.

In all plots, STFT results are presented in red lines with squares, and SSBT results in green lines with triangles. Results for an accurate RFR (that is, assuming we ideally know \textit{a priori} all $A_{m,k}'[l]$ and $A_{m,k}''[l]$) are in lighter continuous lines, and for estimate RFR (via \cref{eq:sec2:calc_RFR_ft_expec,eqs:sec2:calc_RFR_rft_expec}) are in darker dotted lines. For simplicity, the STFT for an accurate RFR will be labeled STFT-A, and for an estimated RFR, it will be STFT-E. The same logic is applied for SSBT-A and SSBT-E. We will focus our efforts on comparing the results between the two different transforms for the two conditions (accurate and estimated RFRs) and not so much on comparing the results between the two conditions.

\begin{figure}[!t]
	\centering
	\includesvg[width=0.7\linewidth]{figures/drawing/room_layout.svg}
	\caption{Room layout for simulations.}
	\label{fig:room_layout}
\end{figure}
%

\subsection{Metrics of interest}

The main objective of the compared filters is to reduce the loudspeaker's signal while preserving the desired signal without distortion. Along this, given the regularization parameter, $\alpha$ added to the problem, the minimal enhancement for white noise is also of interest. The maintenance of the desired signal through the desired signal reduction factor (DSRF, or $\dsrf$), the loudspeaker's signal minimization will be measured through the gain in SER (gSER), and the reduction of the white noise through the gain in SNR (gSNR, or $\gsnr$). We will also observe the directivity index (DI, or $\di$), which measures the beamformer's behavior when employed in a spherically anisotropic noise field. Respectively, these metrics in their time-dependent broadband formulations are given by
\begin{subgather}
	\dsrf[l] = \frac{\sum_{k}\abs{X_{1,k}[l]}^2}{\sum_{k}\abs{X_{f,k}[l]}^2} \\
	\gser[l] = \frac{\sum_{k}\abs{S_{1,k}[l]}^2}{\sum_{k}\abs{S_{f,k}[l]}^2} \cdot \frac{1}{\dsrf[l]}\\
	\gsnr[l] = \frac{\sum_{k}\abs{R_{1,k}[l]}^2}{\sum_{k}\abs{R_{f,k}[l]}^2} \cdot \frac{1}{\dsrf[l]} \\
	\di[l] = \frac{\sum_{k} \abs{\he{\bvf{k}}[l] \bvd{k}[l]}^2}{\sum_{k} \he{\bvf{k}}[l] \bvGa[b]{k}[l] \bvf{k}[l]}
\end{subgather}
in which $\bvGa[b]{k}[l]$ is the spherical anisotropic noise field correlation matrix \cite{habets_generating_2007} and $\bvd{k}[l]$ is the steering vector between the desired source and the sensor array, both assuming a far-end free field environment. We are also interested in a time-average broadband formulation for these metrics, these being given by
\begin{subgather}
	\dsrf = \frac{\sum_{l,k}\abs{X_{1,k}[l]}^2}{\sum_{l,k}\abs{X_{f,k}[l]}^2} \\
	\gser = \frac{\sum_{l,k}\abs{S_{1,k}[l]}^2}{\sum_{l,k}\abs{S_{f,k}[l]}^2} \cdot \frac{1}{\dsrf} \\
	\gsnr = \frac{\sum_{l,k}\abs{R_{1,k}[l]}^2}{\sum_{l,k}\abs{R_{f,k}[l]}^2} \cdot \frac{1}{\dsrf} \\
	\di = \frac{\sum_{l,k} \abs{\he{\bvf{k}}[l] \bvd{k}[l]}^2}{\sum_{l,k} \he{\bvf{k}}[l] \bvGa[b]{k}[l] \bvf{k}[l]}
\end{subgather}

We chose to use the gains in SER and SNR metrics rather than the more common ERLE and WNG \cite{wada_enhancement_2012} given an a priori knowledge of distortion on the desired signal. Therefore, the gains become more representative of the results.

\subsection{Comparison for different observed frames}

In this simulation, we compare our filters for the accurate and estimated RFR for a range of considered observed frames $\Ly$. We compare the results for different observed samples in the convolutive filter, where $\Ly = 1$ reduces to the MTF model.

\begin{figure}[t]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__DSRF__iSER_n15__Ly_var.tex}
		\caption{DSRF.}
		\label{subfig:lineplot__DSRF__iSER_n15__Ly_var}
	\end{subfigure}\hfill
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__gSER__iSER_n15__Ly_var.tex}
		\caption{gSER.}
		\label{subfig:lineplot__gSER__iSER_n15__Ly_var}
	\end{subfigure}\\[1em]
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__gSNR__iSER_n15__Ly_var.tex}
		\caption{gSNR.}
		\label{subfig:lineplot__gSNR__iSER_n15__Ly_var}
	\end{subfigure}\hfill
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__DI__iSER_n15__Ly_var.tex}
		\caption{DI.}
		\label{subfig:lineplot__DI__iSER_n15__Ly_var}
	\end{subfigure}\\[1em]
	\ref*{lyplot_legend}
	\caption{Time-average broadband output metrics for the beamformers with varying input $L_Y$'s.}
	\label{fig:lineplot__iSER_n15__Ly_var}
\end{figure}

For all metrics except DI, the accurate results are consistently better than those achieved for an estimated RFR. We also see that the SSBT-A results are worse overall than the accurate STFT-A ones, but not by too much margin (around $3-4\dB$ for all metrics). This is also the case between SSBT-E and STFT-E; however, for the estimated case, we also have a much higher desired signal distortion, especially for the STFT output, which considerably adds to the performance loss of the former compared to the latter for all metrics. If one were to compare the gain in SER, it would be comparably lower for the SSBT-E than the STFT-E.

Also, in this situation, the best estimate results are obtained with the STFT for $\Ly = 1$. With $\Ly = 2$, both the desired signal's distortion increases, and the gSER sharply decreases, increasing again as we increase $\Ly$, but never achieving the same performance. This is likely related to errors in the RFR estimation for frames other than the main one being more prevalent, given that these windows carry less information, and these errors are such that they deteriorate the filter more than the addition of new frames helps it. Also, when using the estimate RFR (at least with the STFT), the estimate with $\Ly = 1$ already takes into account some information about the different windows' correlations in regards to the desired signal, which explains the STFT-E results being better even than the STFT-A results for this exact situation.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Comparison for different number o frames}

In this simulation, we now compare the beamformers in a scenario where we consider only the MTF model and increase the number of samples per window. This minimizes the problems exposed in \cref{subsec:sec2:rfr_estimation_time-freq_transforms} since we don't consider different windows. Also, by increasing the number of samples per window, we minimize the frequency aliasing effects between frames due to the windowing process of the time-frequency transform and contemplate more of the desired signal on each window.
\begin{figure}[!ht]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__DSRF__N_var__iSER_n15__Ly_1.tex}
		\caption{DSRF.}
		\label{subfig:lineplot__DSRF__N_var__iSER_n15__Ly_1}
	\end{subfigure}\hfill
	%
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__gSER__N_var__iSER_n15__Ly_1.tex}
		\caption{gSER.}
		\label{subfig:lineplot__gSER__N_var__iSER_n15__Ly_1}
	\end{subfigure}\\[1em]
	%
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__gSNR__N_var__iSER_n15__Ly_1.tex}
		\caption{gSNR.}
		\label{subfig:lineplot__gSNR__N_var__iSER_n15__Ly_1}
	\end{subfigure}\hfill
	%
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__DI__N_var__iSER_n15__Ly_1.tex}
		\caption{DI.}
		\label{subfig:lineplot__DI__N_var__iSER_n15__Ly_1}
	\end{subfigure}\\[1em]
	\ref*{lyplot_legend}
	\caption{Output metrics for the beamformers over time, in the base scenario.}
	\label{fig:lineplot__N_var__iSER_n15__Ly_1}
\end{figure}

The first effect we see is that, as expected, the desired signal's distortion for SSBT-E reduces as we increase the number of windows considered. We also see that for all other metrics, the SSBT-E performance approaches that of the SSBT-A as we increase $N$. The same happens for the STFT filters; however, the difference is negligible with far fewer samples. Here, it is also visible that for high $N$, the SSBT results are only slightly worse than the STFT ones for both the accurate and estimated RFR cases. This supports the previous theoretical claims, where we stated that increasing the number of samples per frame reduces the RFR estimation errors. This also shows a niche where the SSBT could be employed since its errors are reduced for a high number of bins (although still more significant than the STFT errors).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Comparison for different iSER}

We now compare our results for different values of input SER; that is, we change the signal's power in the source within the device, right next to the sensors.
\begin{figure}[!ht]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__DSRF__iSER_var__Ly_1.tex}
		\caption{DSRF - $\Ly = 1$.}
		\label{subfig:lineplot__DSRF__iSER_var__Ly_1}
	\end{subfigure}\hfill
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__DSRF__iSER_var__Ly_16.tex}
		\caption{DSRF - $\Ly = 16$.}
		\label{subfig:lineplot__DSRF__iSER_var__Ly_16}
	\end{subfigure}\\[1em]
	%
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__gSER__iSER_var__Ly_1.tex}
		\caption{gSER - $\Ly = 1$.}
		\label{subfig:lineplot__gSER__iSER_var__Ly_1}
	\end{subfigure}\hfill
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__gSER__iSER_var__Ly_16.tex}
		\caption{gSER - $\Ly = 16$.}
		\label{subfig:lineplot__gSER__iSER_var__Ly_16}
	\end{subfigure}\\[1em]
	%
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__gSNR__iSER_var__Ly_1.tex}
		\caption{gSNR - $\Ly = 1$.}
		\label{subfig:lineplot__gSNR__iSER_var__Ly_1}
	\end{subfigure}\hfill
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__gSNR__iSER_var__Ly_16.tex}
		\caption{gSNR - $\Ly = 16$.}
		\label{subfig:lineplot__gSNR__iSER_var__Ly_16}
	\end{subfigure}\\[1em]
	%
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__DI__iSER_var__Ly_1.tex}
		\caption{DI - $\Ly = 1$.}
		\label{subfig:lineplot__DI__iSER_var__Ly_1}
	\end{subfigure}\hfill
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__DI__iSER_var__Ly_16.tex}
		\caption{DI - $\Ly = 16$.}
		\label{subfig:lineplot__DI__iSER_var__Ly_16}
	\end{subfigure}\\[1em]
	\ref*{lyplot_legend}
	\caption{Output metrics for the beamformers for varying input SERs.}
	\label{fig:lineplot__iSER_var__Ly_1}
\end{figure}

For high SER and $\Ly = 1$, the SSBT-A filter has a better gSER performance than the STFT-A one; however, this isn't followed by a better gSNR or DI, though they are similar in these two. For $\Ly = 16$, the STFT-A results are still strictly better than those for SSBT-A. However, they are similar between the two filters (as previously), getting closer as we increase the input SER.

For the estimated RFR outputs, the STFT-E results are strictly superior with $\Ly = 1$, being substantially better for gain in SER and SNR. Also, the SSBT-E and STFT-E results are similar for high input SERs and $\Ly = 16$, identical to the accurate RFR comparison. These results lead us to another niche where the SSBT has a comparable (or even better) performance than the STFT, with $\Ly = 1$ and input SERs above $-15\dB$. This, allied with the results from the previous comparison, leads us to some scenarios where the SSBT filter's results could surpass those of the STFT.

The simulation results presented in \cref{fig:lineplot__N_512__iSER_var__Ly_1} are for a varying input SER but now with $N = 512$ samples per window and only the MTF model (since there are enough samples to capture the whole RFR). This was chosen using the knowledge from \cref{subsec:sec2:rfr_estimation_time-freq_transforms}, where we theoretically had that higher $N$ would minimize the effects of estimation error, which was confirmed with the practical results from \cref{fig:lineplot__N_var__iSER_n15__Ly_1}.

\begin{figure}[!ht]
	\centering
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__DSRF__N_512__iSER_var__Ly_1.tex}
		\caption{DSRF - $\Ly = 1$, $N = 512$.}
		\label{subfig:lineplot__DSRF__N_512__iSER_var__Ly_1}
	\end{subfigure}\hfill
	%
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__gSER__N_512__iSER_var__Ly_1.tex}
		\caption{gSER - $\Ly = 1$, $N = 512$.}
		\label{subfig:lineplot__gSER__N_512__iSER_var__Ly_1}
	\end{subfigure}\\[1em]
	%
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__gSNR__N_512__iSER_var__Ly_1.tex}
		\caption{gSNR - $\Ly = 1$, $N = 512$.}
		\label{subfig:lineplot__gSNR__N_512__iSER_var__Ly_1}
	\end{subfigure}\hfill
	%
	\begin{subfigure}{0.49\textwidth}
		\centering
		\input{figures/lineplot__DI__N_512__iSER_var__Ly_1.tex}
		\caption{DI - $\Ly = 1$, $N = 512$.}
		\label{subfig:lineplot__DI__N_512__iSER_var__Ly_1}
	\end{subfigure}\\[1em]
	\ref*{lyplot_legend}
	\caption{Output metrics for the beamformers for varying input SERs.}
	\label{fig:lineplot__N_512__iSER_var__Ly_1}
\end{figure}

For accurate results, we see behavior similar to those obtained in \cref{fig:lineplot__iSER_var__Ly_1}. With lower iSERs, the SSBT-A results were slightly worse than the STFT-A ones, although similar to what was previously seen, and for higher input SERs, the SSBT-A results approached those of the STFT-A filter, even surpassing them in terms of DI. This behavior isn't seen in the estimated RFR results. Even though a high $N$ was used here, which in theory would lead to the estimate and accurate results being similar for the SSBT (in accordance to \cref{fig:lineplot__N_var__iSER_n15__Ly_1}), we see that increasing the input SER leads to worse performance, similar to the results seen in \cref{fig:lineplot__iSER_var__Ly_1}. However, here, with a very low input SER (below approx. $-20 \dB$), the SSBT-E results were identical to the SSBT-A ones, and these were just marginally worse compared to the STFT ones. This indicates one range of operation where the practical (i.e., the estimated) SSBT results are comparable to the STFT ones and in which it could be employed and have a sufficiently high performance, such that the tradeoff between the cost of implementation and loss of performance could be viable.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{General results}

The SSBT-A results are similar (although mostly slightly worse) to the STFT-A results. Given that the SSBT beamformer is a strictly real-valued filter, this could be a worthwhile tradeoff between a slight loss of performance and a faster algorithm for beamforming, which could also be implemented on simpler (thus cheaper) hardware.

However, we also saw that these outlines needed to be followed when the beamformer was designed with an estimated desired signal RFR. In this scenario, the SSBT results were drastically worse when compared to those obtained through the STFT, except for the case with a multiplicative filter (instead of a convolutive one), with a sufficiently large number of samples per frame and a low input SER. In this instance, the SSBT-E results were comparable to the STFT-E ones and were close to the accurate RFR metrics. This suggests that employing the SSBT with an inherently more robust beamformer could lead to viable applications. However, this is outside the scope of this work.